var playerName=0,jailtime_total=0,fine_total=0,bail_total=0,max_jailtime=480,max_fine=Infinity,max_bail=25e3,addedChargeData=[],chargeData=[],foundedArrData=[];function viewData(){console.log("added charge index list on session");let e=JSON.parse(sessionStorage.getItem("addedCharge"));console.log(e),console.log("added charge index list"),console.log(addedChargeData),console.log("founded charge index list"),console.log(foundedArrData)}async function loadTableData(){let e=await fetch("data.json");chargeData=await e.json();let t=document.getElementById("chargeTableBody");if(t.innerHTML="",chargeData.forEach((e,a)=>{let l=splitChargeCode(e.charge).Code,n=linkHandler(l),d=splitChargeCode(e.charge).Charge,r=parseFloat(e.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}),o=parseFloat(e.bail).toLocaleString("en-US",{style:"currency",currency:"USD"}),i=document.createElement("tr");i.innerHTML=`
            <td hidden translate="no" class=".added-index">${a}</td>
            <td hidden translate="no">${e.code}</td>
            <td translate="no" onclick="copyPureCharge(${a})" class="selectable-text" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-title="Click to copy">${l}</td>
            <td translate="no">${d}${""===l?"":`
                <a href="https://police.san-andreas.net/viewtopic.php?t=148639#:~:text=${n}"target="_blank" rel="noopener noreferrer">
                    <i class="bi bi-link-45deg"></i>
                </a>
            `}
            </td>
            <td translate="no">${e.jailtime>0?e.jailtime:"-"}</td>
            <td translate="no">${e.fine>0?r:"-"}</td>
            <td translate="no">${e.bail>0?o:"-"}</td>
            <td><button onclick="AddCharge(${a})" class="btn btn-primary add-btn" id="add-btn-${a}">ADD</i></button></td>
        `,t.appendChild(i)}),initTooltip(),loadChargeTable(),null!==sessionStorage.getItem("s_playerName")){let a=document.getElementById("playerName");"0"===(playerName=sessionStorage.getItem("s_playerName"))?(sessionStorage.removeItem("s_playerName"),a.value=""):(a.value=playerName,updateName(playerName))}}function loadChargeTable(){if(null!==sessionStorage.getItem("addedCharge")){addedChargeData=JSON.parse(sessionStorage.getItem("addedCharge")),addedChargeData=[...new Set(addedChargeData)];for(let e=0;e<addedChargeData.length;e++){let t=addedChargeData[e];AddCharge(t,!1)}}}function AddCharge(e,t=!0){if(!Number.isInteger(e))throw Error("'index' only accepts an integer.");if(document.getElementById("add-btn-"+e).disabled=!0,!0===t){if(addedChargeData.includes(e)){console.log("Data sudah ada di tabel seleksi.");return}addedChargeData.push(e),addedChargeData.sort((e,t)=>e-t),sessionStorage.setItem("addedCharge",JSON.stringify(addedChargeData))}let a=chargeData[e],l=document.getElementById("selectedChargeTableBody"),n=splitChargeCode(a.charge).Code,d=splitChargeCode(a.charge).Charge,r=a.fine>0?parseFloat(a.fine).toLocaleString("en-US",{style:"currency",currency:"USD"}):"-",o=a.bail>0?parseFloat(a.bail).toLocaleString("en-US",{style:"currency",currency:"USD"}):"-",i=document.createElement("tr");i.dataset.index=e,i.innerHTML=`
        <td translate="no" class="index" hidden>${e}</td>
        <td translate="no" onclick="copyPureCharge(${e})" class="selectable-text" data-bs-toggle="tooltip" data-bs-placement="left" title="Click to copy">${n}</td>
        <td translate="no" id="charge-${e}" onclick="copyCharge(${e})" class="selectable-text charge-td" title="${a.charge}">${d}</td>
        <td translate="no" class="jailtime">${jailtimeInfo(e)}</td>
        <td translate="no" class="fine">${r}</td>
        <td translate="no" class="bail">${o}</td>
        <td><button onclick="copyCharge(${e})" class="btn btn-secondary">COPY</button></td>
        <td><button onclick="removeCharge(this, '${e}')" class="btn btn-danger">REMOVE</button></td>
    `;let c=!1;for(let s of l.rows)if(parseInt(s.dataset.index)>e){l.insertBefore(i,s),c=!0;break}c||l.appendChild(i),refreshCalculation(),initNewTooltips()}async function removeCharge(e,t){let a=parseInt(t),l=addedChargeData.filter(e=>e!==a);if(l.length>0){let n=JSON.stringify(l);sessionStorage.setItem("addedCharge",n),addedChargeData=l}else sessionStorage.removeItem("addedCharge"),addedChargeData=[];document.getElementById("add-btn-"+t).disabled=!1;let d=e.closest("tr");d.remove(),await refreshCalculation()}function resetCharge(){let e=document.querySelectorAll(".add-btn");e.forEach(function(e){!0===e.disabled&&(e.disabled=!1)}),addedChargeData=[],sessionStorage.removeItem("addedCharge");let t=document.getElementById("selectedChargeTableBody");t.innerHTML="",refreshCalculation()}async function refreshCalculation(){jailtime_total=0,fine_total=0,bail_total=0;for(let e=0;e<addedChargeData.length;e++){let t=chargeData[addedChargeData[e]];t.jailtime>0&&(jailtime_total+=t.jailtime,fine_total+=t.fine,bail_total+=t.bail)}jailtime_total>max_jailtime&&(jailtime_total=max_jailtime),document.getElementById("jailtime-total").textContent=jailtime_total,fine_total>max_fine&&(fine_total=max_fine),document.getElementById("fine-total").textContent=`${fine_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`,bail_total>max_bail&&(bail_total=max_bail),document.getElementById("bail-total").textContent=`${bail_total.toLocaleString("en-US",{style:"currency",currency:"USD"})}`,jailtime_total>60?document.getElementById("location-tag").innerHTML='<span style="cursor: default; word-spacing: 1em;" class="w-100 fs-6 btn btn-info text-bg-info fw-semibold">S A C F</span>':document.getElementById("location-tag").innerHTML="";let a=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=a;let l=document.getElementById("charge-code-data");if(addedChargeData.length>0){let n=`(${addedChargeData.length})`;document.getElementById("charge-total").textContent=n;let d=[];for(let r=0;r<addedChargeData.length;r++){let o=chargeData[addedChargeData[r]];d.push(o.code)}let i=d.join(", ");l.textContent=i,l.setAttribute("onclick","copyChargeCode()"),l.setAttribute("class","selectable-text charge-td"),l.setAttribute("title",i)}else document.getElementById("charge-total").textContent="",l.textContent="",l.removeAttribute("onclick"),l.removeAttribute("class"),l.removeAttribute("title");foundedArrData.length>0&&(foundedArrData.every(e=>addedChargeData.includes(e))?document.getElementById("add-all-btn").disabled=!0:document.getElementById("add-all-btn").disabled=!1)}function updateName(e){playerName="string"==typeof e?e.replace(/ /g,"_"):e,sessionStorage.setItem("s_playerName",playerName);let t=`/arrest ${playerName} ${jailtime_total} ${fine_total} ${bail_total}`;document.getElementById("arrest-command").textContent=t}function copyCharge(e){let t=document.getElementById(`charge-${e}`),a=chargeData[e],l="";l=0===a.jailtime&&a.fine>0?`/ticket ${playerName} ${a.fine} ${a.charge}`:`/su ${playerName} ${a.charge}`;let n=document.createElement("textarea");n.value=l,document.body.appendChild(n),n.select();try{document.execCommand("copy"),t.classList.add("text-secondary-emphasis")}catch(d){console.error("Failed to copy text",d)}document.body.removeChild(n)}function copyPureCharge(e){let t=chargeData[e],a=document.createElement("textarea");a.value=t.charge,document.body.appendChild(a),a.select();try{document.execCommand("copy")}catch(l){alert("Failed to copy text",l)}document.body.removeChild(a)}function copyArrestCMD(){let e=document.getElementById("arrest-command").innerText.trim(),t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(a){alert("Failed to copy text",a)}document.body.removeChild(t)}function copyChargeCode(){let e=[];for(let t=0;t<addedChargeData.length;t++){let a=chargeData[addedChargeData[t]];e.push(a.code)}let l=e.join(", "),n=document.createElement("textarea");n.value=l,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(d){alert("Failed to copy text",d)}document.body.removeChild(n)}function splitChargeCode(e){let t=e.lastIndexOf(".");if(-1===t)return{Code:"",Charge:e.trim()};{let a=e.substring(0,t+1).trim(),l=e.substring(t+1).trim(),n=a.lastIndexOf(".");return -1!==n&&(a=a.substring(0,n)+a.substring(n+1)),{Code:a,Charge:l}}}function jailtimeInfo(e){let t=chargeData[e];return 0===t.jailtime&&t.fine>0?'<span class="badge text-bg-secondary mt-2">TICKET</span>':0===t.jailtime&&0===t.fine?'<span class="badge text-bg-secondary mt-2">TAG</span>':t.jailtime}function addAllFoundedCharge(){if(foundedArrData.length>0&&!foundedArrData.every(e=>addedChargeData.includes(e)))for(let e=0;e<foundedArrData.length;e++)null!==chargeData[foundedArrData[e]]&&AddCharge(parseInt(foundedArrData[e]))}function linkHandler(e){let t=e.match(/\(1\)\s(A|F|E)/);return t?t[0]:e}function initTooltip(){let e=document.querySelectorAll('[data-bs-toggle="tooltip"]');[...e].map(e=>new bootstrap.Tooltip(e)),e.forEach(function(e){e.addEventListener("click",function(){if("Click to copy"!==e.getAttribute("data-bs-title"))return;e.setAttribute("data-bs-title","Copied!");let t=bootstrap.Tooltip.getInstance(e);t.dispose(),(t=new bootstrap.Tooltip(e)).show(),setTimeout(function(){e.setAttribute("data-bs-title","Click to copy"),t.dispose(),t=new bootstrap.Tooltip(e)},3e3)})})}function initNewTooltips(){let e=document.querySelectorAll('[data-bs-toggle="tooltip"]:not([data-tooltip-initialized="true"])');[...e].map(e=>(e.setAttribute("data-tooltip-initialized","true"),new bootstrap.Tooltip(e))),e.forEach(function(e){e.addEventListener("click",function(){if("Click to copy"!==e.getAttribute("data-bs-title"))return;e.setAttribute("data-bs-title","Copied!");let t=bootstrap.Tooltip.getInstance(e);t.dispose(),(t=new bootstrap.Tooltip(e)).show(),setTimeout(function(){e.setAttribute("data-bs-title","Click to copy"),t.dispose(),t=new bootstrap.Tooltip(e)},3e3)})})}document.addEventListener("DOMContentLoaded",loadTableData),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("playerName");e.addEventListener("input",function(){let t=e.value.trim();""===t&&(t=0,sessionStorage.removeItem("s_playerName")),updateName(t)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("searchInput"),t=document.getElementById("chargeTableBody"),a=t.getElementsByTagName("tr"),l=document.getElementById("chargeTableFooter");e.addEventListener("input",function(){let t=e.value.toLowerCase().trim(),n=t.replace(/\s/g,"").replace(/\./g,"");n=(n=n.split(",")).filter(e=>/^\d/.test(e)),l.hidden=!0,foundedArrData=[];let d=!1;for(let r=0;r<a.length;r++){let o=a[r].cells[0].textContent||a[r].cells[0].innerText,i=a[r].cells[1].textContent||a[r].cells[1].innerText,c=a[r].cells[2].textContent||a[r].cells[2].innerText,s=a[r].cells[3].textContent||a[r].cells[3].innerText,g=!1;if(n.length>1){for(let h=0;h<n.length&&!(foundedArrData.length>=20);h++)if(i.toLowerCase().indexOf(n[h].toLowerCase())>-1){g=!0,foundedArrData.push(parseInt(o));break}}g?(a[r].style.display="",d=!0):i.toLowerCase().indexOf(t)>-1||c.toLowerCase().indexOf(t)>-1||s.toLowerCase().indexOf(t)>-1?a[r].style.display="":a[r].style.display="none"}d&&(l.hidden=!1,foundedArrData.every(e=>addedChargeData.includes(e))?document.getElementById("add-all-btn").disabled=!0:document.getElementById("add-all-btn").disabled=!1)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("searchInput"),t=document.getElementById("playerName");document.addEventListener("keydown",a=>{if(a.ctrlKey){let l=a.key.toLowerCase();"k"===l&&(a.preventDefault(),e.focus()),"s"===l&&(a.preventDefault(),t.focus()),"enter"===l&&(a.preventDefault(),addAllFoundedCharge())}}),$(window).scroll(function(){$(this).scrollTop()>100?$("#back-to-top").fadeIn():$("#back-to-top").fadeOut()}),$("#back-to-top").click(function(){return $("html, body").animate({scrollTop:0},0),!1});let a;function l(){a=setTimeout(resetCharge,300)}function n(){clearTimeout(a)}(resetButtonElement=document.getElementById("reset-btn")).addEventListener("mousedown",l),resetButtonElement.addEventListener("mouseup",n),resetButtonElement.addEventListener("mouseleave",n),resetButtonElement.addEventListener("touchstart",l),resetButtonElement.addEventListener("touchend",n),resetButtonElement.addEventListener("touchcancel",n)});
